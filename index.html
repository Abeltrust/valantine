<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>A Gentle Valentine</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Bootstrap CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Allura&display=swap" rel="stylesheet">

<style>
/* =====================
   THEME
===================== */
:root {
  --bg: #fff7ef;
  --card: #fff1e6;
  --accent: #b71c1c;
  --soft: #6b5e57;
}

body {
  margin: 0;
  background: var(--bg);
  font-family: "Playfair Display", serif;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* =====================
   MAIN FRAME
===================== */
.frame {
  background: var(--card);
  width: 520px;
  padding: 70px 60px;
  border-radius: 24px;
  box-shadow: 0 30px 80px rgba(0,0,0,.18);
  text-align: center;
  position: relative;
}

/* =====================
   TEXT
===================== */
h1 {
  font-family: "Allura", cursive;
  font-size: 3rem;
  color: var(--accent);
}

p {
  font-size: 1rem;
  color: var(--soft);
  line-height: 1.7;
}

/* =====================
   ENVELOPE
===================== */
.envelope {
  width: 380px;
  height: 240px;
  margin: 30px auto;
  position: relative;
  perspective: 1200px;
}

.envelope .body {
  position: absolute;
  inset: 0;
  background: linear-gradient(#c62828, #b71c1c);
  border-radius: 10px;
}

.envelope .flap {
  position: absolute;
  top: 0;
  width: 100%;
  height: 55%;
  background: #d32f2f;
  clip-path: polygon(0 0, 50% 100%, 100% 0);
  transform-origin: top;
  transition: transform 1.6s ease;
  z-index: 3;
}

.envelope .letter {
  position: absolute;
  inset: 18px;
  background: #fff;
  border-radius: 6px;
  padding: 26px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-size: 18px;
  line-height: 1.6;
  transform: translateY(40%);
  opacity: 0;
  transition: transform 1.6s ease, opacity 1.6s ease;
}

.envelope.open .flap {
  transform: rotateX(-160deg);
}

.envelope.open .letter {
  transform: translateY(-5%);
  opacity: 1;
}

/* =====================
   BUTTONS
===================== */
button {
  padding: 12px 26px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  font-size: 16px;
}

.btn-accent {
  background: var(--accent);
  color: white;
}

.btn-outline {
  background: transparent;
  border: 1px solid #aaa;
  color: #444;
}

/* NO button area */
.button-area {
  position: relative;
  height: 120px;
}

#noBtn {
  position: absolute;
  left: 200px;
  pointer-events: none;
  transition: transform .25s ease;
}
</style>
</head>

<body>

<div class="frame" id="app"></div>
<script>
  /* =====================
     AUDIO
  ===================== */
  const music = new Audio(
    "https://cdn.pixabay.com/audio/2023/03/07/audio_1b5c2f93df.mp3"
  );
  music.loop = true;
  
  /* =====================
     STATE
  ===================== */
  let stage = 0;          // overall stage
  let messageIndex = 0;  // prelude messages
  let noClicks = 0;
  let isValentine = false;
  
  const app = document.getElementById("app");
  
  /* =====================
     CONTENT
  ===================== */
  const PRELUDE_MESSAGES = [
    "Hey‚Ä¶ how have you been, really?",
    "I hope today has been gentle with you.",
    "Love doesn‚Äôt always shout ‚Äî sometimes it just sits quietly.",
    "It‚Äôs nice when someone chooses care, even in small ways.",
    "So I wanted to ask you something‚Ä¶"
  ];
  
  const NO_PHRASES = [
    "No üíî",
    "Pretty please? ü•∫",
    "But we'd be so cute together üíï",
    "One more chance?",
    "Don't break my heart :(",
    "What about a maybe?",
    "I'm fragile üò≠"
  ];
  
  /* =====================
     RENDER ROUTER
  ===================== */
  function render() {
    if (stage === 0) renderIntro();
    else if (stage === 1) renderPrelude();
    else if (stage === 2) renderQuestion();
    else if (stage === 3) renderSuccess();
  }
  
  /* =====================
     STAGES
  ===================== */
  function renderIntro() {
    app.innerHTML = `
      <p class="pop">üå∏</p>
      <p>This is a small moment made with care.</p>
      <button class="btn-accent mt-4" onclick="startExperience()">
        Begin
      </button>
    `;
  }
  
  function startExperience() {
    music.play().catch(() => {});
    stage = 1;
    render();
  }
  
  /* ---------- PRELUDE (5 messages) ---------- */
  function renderPrelude() {
    app.innerHTML = `
      <div class="pop">üå∏üå∑üíê</div>
      <p style="font-size:1.1rem;">
        ${PRELUDE_MESSAGES[messageIndex]}
      </p>
      <button class="btn-accent mt-4" onclick="nextPrelude()">
        Continue
      </button>
    `;
  }
  
  function nextPrelude() {
    messageIndex++;
    if (messageIndex >= PRELUDE_MESSAGES.length) {
      stage = 2;
    }
    render();
  }
  
  /* ---------- QUESTION ---------- */
  function renderQuestion() {
    music.pause();           // üîë STOP MUSIC HERE
    music.currentTime = 0;
  
    const yesSize = 16 + noClicks * 5;
  
    app.innerHTML = `
      <h1>Will you be my Valentine? üíò</h1>
  
      <div class="buttons mt-4">
        <button
          id="yesBtn"
          style="font-size:${yesSize}px; min-width:140px;"
        >
          Yes üíñ
        </button>
  
        <button
          id="noBtn"
          style="min-width:140px;"
        >
          ${noClicks === 0
            ? "No"
            : NO_PHRASES[Math.min(noClicks - 1, NO_PHRASES.length - 1)]}
        </button>
      </div>
    `;
  
    document.getElementById("yesBtn").onclick = handleYes;
    enableNoRun();
  }
  
  /* ---------- NO BUTTON LOGIC ---------- */
  function enableNoRun() {
    const noBtn = document.getElementById("noBtn");
    const area = document.querySelector(".buttons");
  
    // ensure precise spacing
    noBtn.style.left = "260px";
    noBtn.style.top = "0";
    noBtn.style.position = "absolute";
    noBtn.style.pointerEvents = "none";
  
    area.onmousemove = (e) => {
      const r = area.getBoundingClientRect();
      const x = e.clientX - r.left;
      const y = e.clientY - r.top;
  
      noBtn.style.transform =
        `translate(${-(x - 160) * 0.35}px, ${-(y - 40) * 0.35}px)`;
    };
  
    // count attempts
    area.onclick = () => {
      noClicks++;
      render();
    };
  }
  
  /* ---------- YES ---------- */
  function handleYes() {
    stage = 3;
    document.body.style.background = "#7b0f1b";
    render();
  }
  
  /* ---------- SUCCESS ---------- */
  function renderSuccess() {
    app.innerHTML = `
      <div class="pop">üåπüíñüå∏üíê</div>
      <h1>Yay!!! üíñ</h1>
      <p style="color:#ffeaea;">
        This moment just bloomed beautifully.
      </p>
  
      <a
        href="https://wa.me/?text=${encodeURIComponent(
          "üå∏ Someone shared a gentle Valentine moment with me üíñ " +
          location.href
        )}"
        target="_blank"
      >
        <button class="btn-accent mt-4">
          Share on WhatsApp üí¨
        </button>
      </a>
    `;
  
    startFalling();
  }
  
  /* =====================
     FALLING FLOWERS / HEARTS
  ===================== */
  function startFalling() {
    const icons = ["üíñ","üå∏","üíê","‚ù§Ô∏è","üåπ"];
  
    setInterval(() => {
      const el = document.createElement("div");
      el.className = "fall";
      el.textContent = icons[Math.floor(Math.random() * icons.length)];
      el.style.left = Math.random() * 100 + "vw";
      el.style.animationDuration = (4 + Math.random() * 4) + "s";
      document.body.appendChild(el);
  
      setTimeout(() => el.remove(), 8000);
    }, 300);
  }
  
  /* INIT */
  render();
  </script>
<!-- <script>
/* =====================
   STATE ENGINE
===================== */
let stage = 0;
let envelopeIndex = 0;

const envelopeMessages = [
  "Some feelings arrive quietly.",
  "Care does not need to be loud.",
  "Kindness stays longer than words.",
  "Love doesn‚Äôt rush.",
  "Warmth is a choice.",
  "Gentle things are powerful.",
  "What is real does not fade.",
  "Intention changes everything.",
  "Being seen matters.",
  "This moment was made with care."
];

const app = document.getElementById("app");

function nextStage() {
  stage++;
  render();
}

/* =====================
   RENDER FUNCTIONS
===================== */
function render() {
  if (stage === 0) renderIntro();
  else if (stage === 1) renderIntention();
  else if (stage >= 2 && stage < 12) renderEnvelope();
  else if (stage === 12) renderQuestion();
  else if (stage === 13) renderAffirmation();
  else renderShare();
}

/* =====================
   STAGES
===================== */
function renderIntro() {
  app.innerHTML = `
    <p>This is a small moment.</p>
    <button class="btn-accent mt-4" onclick="nextStage()">Continue</button>
  `;
}

function renderIntention() {
  app.innerHTML = `
    <p>No pressure. No expectations.<br>Just something made gently.</p>
    <button class="btn-accent mt-4" onclick="nextStage()">Begin</button>
  `;
}

function renderEnvelope() {
  app.innerHTML = `
    <div class="envelope open" id="env">
      <div class="flap"></div>
      <div class="body"></div>
      <div class="letter">${envelopeMessages[envelopeIndex]}</div>
    </div>
    <button class="btn-accent mt-3" onclick="nextEnvelope()">Next</button>
  `;

  // replay open animation
  const env = document.getElementById("env");
  env.classList.remove("open");
  setTimeout(() => env.classList.add("open"), 300);
}

function nextEnvelope() {
  envelopeIndex++;
  nextStage();
}

function renderQuestion() {
  app.innerHTML = `
    <h1>Will you be my Valentine?</h1>
    <div class="button-area mt-4">
      <button class="btn-accent" onclick="nextStage()">Yes ü§ç</button>
      <button class="btn-outline" id="noBtn">No</button>
    </div>
  `;

  const noBtn = document.getElementById("noBtn");
  const area = document.querySelector(".button-area");

  area.addEventListener("mousemove", (e) => {
    const r = area.getBoundingClientRect();
    const x = e.clientX - r.left;
    const y = e.clientY - r.top;
    noBtn.style.transform = `translate(${-(x - 120) * 0.3}px, ${-(y - 40) * 0.3}px)`;
  });
}

function renderAffirmation() {
  app.innerHTML = `
    <h1>Thank you ü§ç</h1>
    <p>You chose gently.</p>
    <button class="btn-accent mt-4" onclick="nextStage()">Continue</button>
  `;
}

function renderShare() {
  const text = encodeURIComponent(
    "Someone shared this gentle Valentine moment with me ü§ç"
  );

  app.innerHTML = `
    <p>If this made you feel something,<br>you can pass it on.</p>
    <a href="https://wa.me/?text=${text}%20${location.href}" target="_blank">
      <button class="btn-accent mt-4">Share on WhatsApp</button>
    </a>
  `;
}

/* INIT */
render();
</script> -->

</body>
</html>